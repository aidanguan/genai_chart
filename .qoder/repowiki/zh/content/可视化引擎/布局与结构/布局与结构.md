# 布局与结构

<cite>
**本文档中引用的文件**  
- [Flex.tsx](file://antv_infographic/infographic/src/designs/layouts/Flex.tsx)
- [Align.tsx](file://antv_infographic/infographic/src/designs/layouts/Align.tsx)
- [registry.ts](file://antv_infographic/infographic/src/designs/structures/registry.ts)
- [sequence-steps.tsx](file://antv_infographic/infographic/src/designs/structures/sequence-steps.tsx)
- [sequence-timeline.tsx](file://antv_infographic/infographic/src/designs/structures/sequence-timeline.tsx)
- [hierarchy-tree.tsx](file://antv_infographic/infographic/src/designs/structures/hierarchy-tree.tsx)
- [compare-hierarchy-row.tsx](file://antv_infographic/infographic/src/designs/structures/compare-hierarchy-row.tsx)
- [relation-network.tsx](file://antv_infographic/infographic/src/designs/structures/relation-network.tsx)
- [list-grid.tsx](file://antv_infographic/infographic/src/designs/structures/list-grid.tsx)
- [list-pyramid.tsx](file://antv_infographic/infographic/src/designs/structures/list-pyramid.tsx)
</cite>

## 目录
1. [布局系统](#布局系统)
2. [信息结构组件](#信息结构组件)
3. [结构注册机制](#结构注册机制)
4. [复杂布局嵌套案例](#复杂布局嵌套案例)
5. [常见问题与解决方案](#常见问题与解决方案)

## 布局系统

AntV Infographic 提供了两种核心布局组件：Flex 和 Align，用于构建灵活且可预测的视觉布局。

### Flex 布局组件

Flex 布局基于 CSS Flexbox 模型，提供了一维空间内的元素排列能力。该组件支持主轴（main axis）和交叉轴（cross axis）的灵活配置，能够实现水平或垂直方向的元素排列。

Flex 布局的关键属性包括：
- **方向（direction）**：控制子元素的排列方向（水平或垂直）
- **对齐方式（justifyContent）**：定义主轴上的对齐策略
- **交叉轴对齐（alignItems）**：定义交叉轴上的对齐方式
- **换行（wrap）**：控制子元素是否在空间不足时换行

Flex 布局算法会根据容器尺寸和子元素的尺寸约束，自动计算每个子元素的位置和大小，确保布局的响应性和适应性。

### Align 布局组件

Align 布局专注于元素在二维空间中的精确定位，特别适用于需要精确对齐多个元素的场景。该组件通过指定对齐基准和对齐方式，实现元素间的视觉对齐。

Align 布局支持多种对齐模式：
- **左对齐/右对齐**：水平方向的边缘对齐
- **顶部对齐/底部对齐**：垂直方向的边缘对齐
- **居中对齐**：在指定轴上的中心对齐
- **基线对齐**：文本内容的基线对齐

Align 布局算法会分析所有子元素的边界框，然后根据指定的对齐基准重新计算每个元素的位置，确保视觉上的一致性。

**Section sources**
- [Flex.tsx](file://antv_infographic/infographic/src/designs/layouts/Flex.tsx)
- [Align.tsx](file://antv_infographic/infographic/src/designs/layouts/Align.tsx)

## 信息结构组件

信息结构组件用于表达不同类型的数据关系和层次结构，每种结构都有其特定的视觉模式和数据适配方式。

### 序列型结构

序列型结构用于表达具有时间或逻辑顺序的信息流。

#### sequence-steps
该组件以步骤条的形式展示线性流程，每个步骤通常包含图标、标题和描述。适用于展示操作流程、发展阶段等有序信息。

#### sequence-timeline
时间线结构以时间轴为基础，展示事件在时间维度上的分布。支持水平和垂直两种布局，能够处理密集的时间点信息。

**Section sources**
- [sequence-steps.tsx](file://antv_infographic/infographic/src/designs/structures/sequence-steps.tsx)
- [sequence-timeline.tsx](file://antv_infographic/infographic/src/designs/structures/sequence-timeline.tsx)

### 层次型结构

#### hierarchy-tree
树状结构用于展示父子关系的层级数据，如组织架构、文件目录等。支持多种连接线样式和节点布局方式，能够清晰表达复杂的层次关系。

**Section sources**
- [hierarchy-tree.tsx](file://antv_infographic/infographic/src/designs/structures/hierarchy-tree.tsx)

### 比较型结构

#### compare-hierarchy-row
该结构用于并排比较两个或多个具有相似层次结构的数据集。通过相同的层级对齐，便于用户进行跨维度的对比分析。

**Section sources**
- [compare-hierarchy-row.tsx](file://antv_infographic/infographic/src/designs/structures/compare-hierarchy-row.tsx)

### 关系型结构

#### relation-network
网络关系结构用于展示实体间的复杂关联，如社交网络、知识图谱等。采用力导向布局算法，自动优化节点位置，减少边的交叉。

**Section sources**
- [relation-network.tsx](file://antv_infographic/infographic/src/designs/structures/relation-network.tsx)

### 列表型结构

#### list-grid
网格列表结构将数据项以二维网格形式排列，适用于展示同类型的数据集合，如产品展示、图片画廊等。

#### list-pyramid
金字塔列表结构以层级堆叠的方式展示数据，通常用于表示数量递减或重要性递减的关系，如人口结构、需求层次等。

**Section sources**
- [list-grid.tsx](file://antv_infographic/infographic/src/designs/structures/list-grid.tsx)
- [list-pyramid.tsx](file://antv_infographic/infographic/src/designs/structures/list-pyramid.tsx)

## 结构注册机制

AntV Infographic 通过 `registry.ts` 文件实现结构注册机制，允许用户自定义和扩展信息结构。

### 注册接口

系统提供了三个核心注册函数：
- `registerStructure`：注册新的结构类型
- `getStructure`：获取指定结构的配置
- `getStructures`：获取所有已注册结构的列表

### 自定义结构开发流程

1. **创建结构组件**：实现新的 React 组件，定义其视觉表现和布局逻辑
2. **定义数据适配器**：编写函数将原始数据转换为组件所需的格式
3. **注册结构**：使用 `registerStructure` 函数将新组件注册到系统中
4. **配置元数据**：提供结构的名称、描述、预览图等元信息

自定义结构需要遵循统一的接口规范，确保与现有系统的兼容性。

**Section sources**
- [registry.ts](file://antv_infographic/infographic/src/designs/structures/registry.ts)

## 复杂布局嵌套案例

在实际应用中，经常需要将多种布局和结构进行嵌套组合，以实现复杂的可视化效果。

一个典型的嵌套案例是：使用 Flex 布局作为外层容器，内部包含一个 hierarchy-tree 结构和一个 relation-network 结构，两者通过 Align 布局进行对齐。这种组合可以同时展示组织架构和团队协作关系。

嵌套布局的渲染顺序遵循从内到外的原则：先计算最内层组件的尺寸，然后逐层向外传递尺寸信息，最终由外层布局组件完成整体定位。

## 常见问题与解决方案

### 布局错位问题

**现象**：子元素位置偏移，对齐失效
**原因**：父容器尺寸计算异常或子元素的尺寸约束冲突
**解决方案**：
1. 检查父容器的尺寸是否被正确设置
2. 确认子元素的尺寸属性（如 width、height）是否合理
3. 使用调试工具查看实际渲染的边界框

### 结构渲染异常

**现象**：结构组件无法正常显示或数据未正确映射
**原因**：数据格式与组件期望的格式不匹配
**解决方案**：
1. 验证数据结构是否符合组件的 schema 要求
2. 检查数据适配器函数的转换逻辑
3. 确认注册的结构类型名称是否正确

**Section sources**
- [Flex.tsx](file://antv_infographic/infographic/src/designs/layouts/Flex.tsx)
- [Align.tsx](file://antv_infographic/infographic/src/designs/layouts/Align.tsx)
- [registry.ts](file://antv_infographic/infographic/src/designs/structures/registry.ts)