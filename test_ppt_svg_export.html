<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG å¯¼å‡º PPT å…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1783FF;
            margin-bottom: 10px;
        }
        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .preview-box {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        .preview-box h3 {
            margin-top: 0;
            color: #333;
        }
        #preview {
            width: 100%;
            min-height: 400px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .svg-output {
            width: 100%;
            min-height: 400px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #1783FF;
            color: white;
        }
        .btn-primary:hover {
            background: #0d6edf;
        }
        .btn-success {
            background: #00C9C9;
            color: white;
        }
        .btn-success:hover {
            background: #00a8a8;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #1783FF;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #1783FF;
        }
        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .info-box li {
            margin: 5px 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š SVG å¯¼å‡º PowerPoint å…¼å®¹æ€§æµ‹è¯•</h1>
        <p class="description">
            æµ‹è¯•å°† AntV Infographic ç”Ÿæˆçš„ SVG å¯¼å‡ºä¸º PPT å…¼å®¹æ ¼å¼ã€‚<br>
            æ–°ç‰ˆæœ¬ä¼šè‡ªåŠ¨å°† foreignObject+span è½¬æ¢ä¸ºæ ‡å‡†çš„ SVG &lt;text&gt; å…ƒç´ ï¼Œç¡®ä¿ PowerPoint å¯ä»¥æ­£ç¡®æ˜¾ç¤ºæ–‡æœ¬ã€‚
        </p>

        <div class="preview-section">
            <div class="preview-box">
                <h3>ğŸ¨ ä¿¡æ¯å›¾é¢„è§ˆ</h3>
                <div id="preview"></div>
            </div>

            <div class="preview-box">
                <h3>ğŸ“ å¯¼å‡ºçš„ SVG ä»£ç </h3>
                <div class="svg-output" id="svgOutput">ç‚¹å‡»"ç”Ÿæˆä¿¡æ¯å›¾"å¼€å§‹...</div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="generateInfographic()">ğŸ¨ ç”Ÿæˆä¿¡æ¯å›¾</button>
            <button class="btn-success" onclick="downloadSVG()">â¬‡ï¸ ä¸‹è½½ SVG (å¯æ‹–å…¥PPTæµ‹è¯•)</button>
        </div>

        <div class="info-box">
            <h4>ğŸ“‹ æµ‹è¯•æ­¥éª¤ï¼š</h4>
            <ul>
                <li>1. ç‚¹å‡»"ç”Ÿæˆä¿¡æ¯å›¾"æŒ‰é’®</li>
                <li>2. æŸ¥çœ‹å³ä¾§ SVG ä»£ç ï¼Œç¡®è®¤ä½¿ç”¨äº† &lt;text&gt; æ ‡ç­¾è€Œé &lt;foreignObject&gt;</li>
                <li>3. ç‚¹å‡»"ä¸‹è½½ SVG"ä¿å­˜æ–‡ä»¶</li>
                <li>4. æ‰“å¼€ PowerPointï¼Œå°† SVG æ–‡ä»¶æ‹–å…¥å¹»ç¯ç‰‡</li>
                <li>5. éªŒè¯æ–‡å­—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { Infographic } from './antv_infographic/infographic/esm/index.js';

        let infographicInstance = null;

        window.generateInfographic = async function() {
            const container = document.getElementById('preview');
            container.innerHTML = '';

            const data = {
                title: 'PDCAå¾ªç¯',
                subtitle: 'PDCA æ˜¯ç”± Planã€Doã€Checkã€Action å››ä¸ªé˜¶æ®µç»„æˆçš„æŒç»­æ”¹è¿›å¾ªç¯ã€‚',
                items: [
                    {
                        title: 'Plan',
                        description: 'è®¡åˆ’é˜¶æ®µï¼šæ˜ç¡®ç›®æ ‡ã€åˆ¶å®šæ–¹æ¡ˆä¸èµ„æºå®‰æ’ï¼Œä¸ºåç»­æ‰§è¡Œæ‰“å¥½åŸºç¡€ã€‚',
                        icon: 'mdi:clipboard-text-outline'
                    },
                    {
                        title: 'Do',
                        description: 'æ‰§è¡Œé˜¶æ®µï¼šæŒ‰ç…§æ—¢å®šè®¡åˆ’è½å®å…·ä½“è¡ŒåŠ¨ï¼Œå®æ–½å¯¹åº”çš„æ–¹æ¡ˆä¸æªæ–½ã€‚',
                        icon: 'mdi:play-circle-outline'
                    },
                    {
                        title: 'Check',
                        description: 'æ£€æŸ¥é˜¶æ®µï¼šå¯¹æ‰§è¡Œç»“æœè¿›è¡Œæ£€æŸ¥ä¸è¯„ä¼°ï¼Œè¯†åˆ«åå·®ä¸é—®é¢˜ã€‚',
                        icon: 'mdi:magnify'
                    },
                    {
                        title: 'Action',
                        description: 'å¤„ç†ä¸æ”¹è¿›é˜¶æ®µï¼šæ ¹æ®æ£€æŸ¥ç»“æœè¿›è¡Œçº åä¸ä¼˜åŒ–ï¼Œå½¢æˆæ–°çš„æ ‡å‡†å¹¶è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚',
                        icon: 'mdi:refresh'
                    }
                ]
            };

            const design = {
                type: 'relation-circle-around',
                structure: { type: 'circle-around' },
                title: { type: 'title' },
                item: { type: 'badge-card' },
                items: [{ type: 'badge-card' }]
            };

            infographicInstance = new Infographic({
                container,
                data,
                design
            });

            infographicInstance.render();

            // å»¶è¿Ÿå¯¼å‡º SVG
            setTimeout(async () => {
                try {
                    const svgDataUrl = await infographicInstance.toDataURL({ type: 'svg' });
                    const svgContent = decodeURIComponent(svgDataUrl.replace('data:image/svg+xml;charset=utf-8,', ''));
                    
                    // æ˜¾ç¤º SVG ä»£ç 
                    document.getElementById('svgOutput').textContent = svgContent;
                    
                    // æ£€æŸ¥æ˜¯å¦åŒ…å« foreignObject
                    if (svgContent.includes('foreignObject')) {
                        console.warn('âš ï¸ SVG ä»åŒ…å« foreignObjectï¼Œå¯èƒ½ä¸å…¼å®¹ PPT');
                    } else {
                        console.log('âœ… SVG å·²è½¬æ¢ä¸ºæ ‡å‡† <text> å…ƒç´ ï¼Œå…¼å®¹ PPT');
                    }
                } catch (error) {
                    console.error('å¯¼å‡º SVG å¤±è´¥:', error);
                }
            }, 500);
        };

        window.downloadSVG = async function() {
            if (!infographicInstance) {
                alert('è¯·å…ˆç”Ÿæˆä¿¡æ¯å›¾ï¼');
                return;
            }

            try {
                const svgDataUrl = await infographicInstance.toDataURL({ type: 'svg' });
                const svgContent = decodeURIComponent(svgDataUrl.replace('data:image/svg+xml;charset=utf-8,', ''));
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([svgContent], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'infographic_ppt_compatible.svg';
                a.click();
                URL.revokeObjectURL(url);
                
                alert('âœ… SVG å·²ä¸‹è½½ï¼è¯·æ‹–å…¥ PowerPoint æµ‹è¯•æ–‡å­—æ˜¾ç¤ºæ•ˆæœã€‚');
            } catch (error) {
                alert('ä¸‹è½½å¤±è´¥: ' + error.message);
            }
        };
    </script>
</body>
</html>
